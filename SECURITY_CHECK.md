# 依存ライブラリのセキュリティチェック

Web打刻ツールには、使用している依存ライブラリの安全性を確認するためのセキュリティチェック機能が含まれています。このドキュメントでは、その機能の詳細と使用方法について説明します。

## 概要

オープンソースのライブラリを使用する際には、セキュリティリスクが伴う場合があります。特に以下のようなリスクが考えられます：

1. **既知の脆弱性**: 公開されているセキュリティ脆弱性を持つライブラリバージョンを使用している場合
2. **悪意のあるパッケージ**: タイポスクワッティング（人気のあるパッケージ名に似た名前を使用する悪意のあるパッケージ）などの攻撃
3. **メンテナンスされていないパッケージ**: 長期間更新されておらず、潜在的な脆弱性が修正されていない可能性があるパッケージ
4. **低品質なパッケージ**: ダウンロード数が少なく、コミュニティによる検証が十分でないパッケージ

セキュリティチェック機能は、これらのリスクを特定し、適切な対応を促すことを目的としています。

## 実行方法

セキュリティチェックは以下の方法で実行できます：

### 1. セットアップ時に実行

`setup_all.bat`（Windows）または`setup_all.sh`（macOS/Linux）を実行すると、セットアップの最後に「セキュリティチェックを実行しますか？」と表示されます。「y」を入力すると、セキュリティチェックが実行されます。

### 2. 手動で実行

いつでも以下のコマンドを実行して、セキュリティチェックを行うことができます：

```bash
# Windowsの場合
python check_dependencies.py

# macOS/Linuxの場合
python3 check_dependencies.py
```

## チェック内容

セキュリティチェックでは、以下の項目を確認します：

### 1. 既知の脆弱性

[Safety DB](https://github.com/pyupio/safety-db)や[PyPI Advisory](https://pypi.org/project/)の情報を参照して、インストールされているパッケージに既知のセキュリティ脆弱性がないかチェックします。

### 2. 怪しいパッケージ

以下のような特徴を持つパッケージを「怪しい」と判断します：

- 既知の悪意のあるパッケージ名と一致する
- 人気のあるパッケージ名に似た名前を使用している（タイポスクワッティング）
- 不審な名前パターンを持つ

### 3. 人気度

[PyPI Stats](https://pypistats.org/)からダウンロード統計を取得し、ダウンロード数の少ないパッケージを特定します。ダウンロード数が少ないパッケージは、コミュニティによる検証が十分でない可能性があります。

### 4. パッケージ情報

各パッケージの基本情報（作者、最終更新日、ホームページなど）を収集し、信頼性の評価に役立てます。

## レポート

セキュリティチェックの結果は、以下の2つのファイルに保存されます：

1. **security_report.json**: 詳細な結果をJSON形式で保存したファイル
2. **security_report.html**: 見やすいHTML形式のレポート

HTMLレポートには以下のセクションが含まれます：

- **サマリー**: 合計パッケージ数、怪しいパッケージ数、脆弱性のあるパッケージ数、人気度の低いパッケージ数
- **怪しいパッケージ**: 怪しいと判断されたパッケージのリストとその理由
- **脆弱性のあるパッケージ**: 既知の脆弱性を持つパッケージのリストと脆弱性の詳細
- **すべてのパッケージ**: インストールされているすべてのパッケージの情報と状態
- **推奨事項**: 検出された問題に対する対応策

## 対応方法

セキュリティチェックで問題が検出された場合は、以下の対応を検討してください：

### 脆弱性のあるパッケージ

1. 最新バージョンにアップデートする
2. 脆弱性が修正されたバージョンに指定する
3. 代替パッケージを使用する

### 怪しいパッケージ

1. パッケージの公式サイトやGitHubリポジトリを確認し、正規のパッケージであることを確認する
2. 正規のパッケージに置き換える
3. 必要ない場合はアンインストールする

### 人気度の低いパッケージ

1. パッケージの信頼性を確認する
2. より人気のある代替パッケージを検討する
3. 必要性を再検討する

## 一般的な推奨事項

セキュリティを向上させるための一般的な推奨事項は以下の通りです：

1. 定期的にパッケージをアップデートする
2. requirements.txtでバージョンを固定する
3. 仮想環境を使用して依存関係を分離する
4. 信頼できるソースからのみパッケージをインストールする

## 注意事項

- セキュリティチェックは完全ではなく、すべてのリスクを検出できるわけではありません。
- 自動チェックの結果は参考情報であり、最終的な判断は人間が行う必要があります。
- 誤検出（false positive）の可能性もあります。
- インターネット接続が必要です。オフライン環境では一部の機能が制限されます。

## トラブルシューティング

セキュリティチェックの実行中に問題が発生した場合は、以下を確認してください：

1. インターネット接続が正常に機能しているか
2. `requests`パッケージがインストールされているか（`pip install requests`でインストール可能）
3. ログファイル（`security_check.log`）にエラーメッセージが記録されていないか

## 更新履歴

- **2023-10-01**: 初期バージョンリリース
- **2023-10-15**: Safety DBの参照方法を改善
- **2023-11-01**: HTMLレポートのデザインを改善
- **2023-12-01**: パッケージの人気度チェック機能を追加 